#!/usr/bin/env bash
# Script to configure Nginx with a custom HTTP response header "X-Served-By"

# Exit on error
set -e

# Install Nginx if not installed
if ! dpkg -l | grep -q nginx; then
    apt update -y
    apt install nginx -y
fi

# Ensure Nginx is running
systemctl start nginx
systemctl enable nginx

# Add custom header in the default Nginx configuration
NGINX_CONF="/etc/nginx/sites-available/default"

# Check if the header is already set to avoid duplicate entries
if ! grep -q "add_header X-Served-By" "$NGINX_CONF"; then
    sed -i '/server_name _;/a \    add_header X-Served-By \"$hostname\";' "$NGINX_CONF"
fi

# Restart Nginx to apply changes
systemctl restart nginx

echo "Nginx configured successfully with X-Served-By header!"
