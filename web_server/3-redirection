#!/usr/bin/env bash
# This script installs and configures Nginx to perform a 301 redirection on /redirect_me

# Update package lists
sudo apt-get update -y

# Install Nginx if it's not already installed
sudo apt-get install nginx -y

# Ensure Nginx is running and enabled on boot
sudo service nginx start
update-rc.d nginx defaults

# Backup the original default config
sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.bak

# Use sed to add the 301 redirection rule under the server block
sudo sed -i '/server {/a \\\n    location /redirect_me { \n        return 301 https://www.youtube.com/watch?v=QH2-TGUlwu4; \n    }' /etc/nginx/sites-available/default

# Check if the location block was correctly added
echo "Checking if the redirection rule is added:"
grep "location /redirect_me" /etc/nginx/sites-available/default

# Allow Nginx through the firewall
sudo ufw allow 'Nginx HTTP'

# Test Nginx configuration for syntax errors
sudo nginx -t

# Restart Nginx to apply the changes (without using systemctl)
sudo service nginx restart
